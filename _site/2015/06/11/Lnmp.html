<!doctype html>
<html>
<head>
  <meta charset="utf-8">
<title>Linux下 nginx安装 + php-fpm安装 | 圣泉山人—随记</title>
<meta name="author" content="圣泉山人">


<link rel="shortcut icon" href="/public/img/myy.png" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="/public/css/bootstrap.css">
<link rel="stylesheet" href="/public/css/font-awesome.css">
<link rel="stylesheet" href="/public/js/prettify/prettify.css">
<link rel="stylesheet" href="/public/css/base.css">
<link href="/pages/atom.xml" rel="alternate" title="圣泉山人—随记" type="application/atom+xml">
</head>
<body>
  <div class="container">
    <div class="row">
      <div class="col-md-3 col-lg-3 col-sm-13 col-xs-13 aside visible-md visible-lg">
  <div class="row">
    <div class="col-md-2 col-xs-2 aside1">
      <br>
      <a class="pjaxlink" href="/"><img src="/public/img/myy.png" class="img-ronuded avatar" style="border-width:0px; border-color:#000"></a>
      <br><br><br><br>
      <ul class="nav nav-pills nav-stacked">
             <!-- 这里是aside1的读书、生活、科研、技术、绘画-->
         <li><a href="#笔记" data-toggle="tab">笔记</a></li>
             <!-- 这里是aside1的读书、生活、科研、技术、绘画-->
         <li><a href="#php" data-toggle="tab">php</a></li>
             <!-- 这里是aside1的读书、生活、科研、技术、绘画-->
         <li><a href="#linux" data-toggle="tab">linux</a></li>
        
        <li><a href="#tags" data-toggle="tab">标签</a></li>  
        <li><a class="pjaxlink" href="/pages/archive.html">归档</a></li>
        <li><a class="pjaxlink" href="/pages/about.html">关于</a></li>  
        <!-- <li><a href="#tags" data-toggle="tab"><i class="fa fa-tags fa-lg"></i></a></li>
        <li><a class="pjaxlink" href="/pages/archive.html"><i class="fa fa-archive fa-lg"></i></a></li>
        <li><a class="pjaxlink" href="/pages/about.html"><i class="fa fa-user fa-lg"></i></a></li>
        这是原来现实汉字的代码，我改为了图标 -->
      </ul>
      <div class="aside1_bottom">
        <table class="table table-condensed">
          <tr>
            <td><a href="/pages/atom.xml" target="_blank"><i class="fa fa-rss fa-lg" style="color:#fff;"></i></a></td>
            <td><a href="mailto:myyd@outlook.com"><i class="fa fa-envelope-o fa-lg" style="color:#fff;"></i></a></td>
          </tr>
        </table>
      </div>
    </div>
    <div class="col-md-10 col-xs-10 aside2">
      <div class="row">
        <div class="tab-content"> 
           
            <div class="tab-pane" id="笔记">
              <div class="list-group">
                <!--<h2 class="center">笔记</h2>-->     <!--原来aside2上面的大标题-->
                
                  <a href="/2015/08/03/about-optimize.html" class="list-group-item-lay pjaxlink">高并发</a>
                
                  <a href="/2015/03/10/Git-Resources.html" class="list-group-item-lay pjaxlink">Git常用命令速查表</a>
                
                  <a href="/2015/03/01/files-upload.html" class="list-group-item-lay pjaxlink">php文件上传</a>
                
              </div>
            </div>
           
            <div class="tab-pane" id="php">
              <div class="list-group">
                <!--<h2 class="center">php</h2>-->     <!--原来aside2上面的大标题-->
                
                  <a href="/2015/09/06/Linux%20-%20memcache.html" class="list-group-item-lay pjaxlink">memcache实现高可用方案</a>
                
                  <a href="/2015/06/15/linux-nginx.html" class="list-group-item-lay pjaxlink">linux 环境下 php 扩展安装通用方法</a>
                
                  <a href="/2015/06/11/Lnmp.html" class="list-group-item-lay pjaxlink">Linux下 nginx安装 + php-fpm安装</a>
                
                  <a href="/2015/06/02/mysql%20-%20optimize.html" class="list-group-item-lay pjaxlink">Mysql优化小技巧</a>
                
                  <a href="/2015/05/02/mysql-index%20.html" class="list-group-item-lay pjaxlink">Mysql索引文件本身的数据结构</a>
                
              </div>
            </div>
           
            <div class="tab-pane" id="linux">
              <div class="list-group">
                <!--<h2 class="center">linux</h2>-->     <!--原来aside2上面的大标题-->
                
                  <a href="/2015/07/06/Linux4.html" class="list-group-item-lay pjaxlink">Linux 4：磁盘与文件系统管理</a>
                
                  <a href="/2015/07/05/Linux3.html" class="list-group-item-lay pjaxlink">Linux 3：文件与目录管理</a>
                
                  <a href="/2015/07/04/Linux2.html" class="list-group-item-lay pjaxlink">Linux 2：文件权限与目录配置</a>
                
                  <a href="/2015/07/03/Linux.html" class="list-group-item-lay pjaxlink">Linux 1：登陆与在线求助man page</a>
                
                  <a href="/2015/07/02/Linux-Problems.html" class="list-group-item-lay pjaxlink">Linux 0：实际问题</a>
                
                  <a href="/2015/06/15/linux-redis.html" class="list-group-item-lay pjaxlink">Linux环境下redis的搭建</a>
                
                  <a href="/2015/06/15/linux-lamp.html" class="list-group-item-lay pjaxlink">lamp环境的搭建</a>
                
                  <a href="/2015/05/20/linux-php.html" class="list-group-item-lay pjaxlink">linux 环境下 php 扩展安装通用方法</a>
                
              </div>
            </div>
                
          <div class="tab-pane" id="tags">
            <div class="panel-group" id="accordion">
              <!--<h2 class="center">标签</h2>-->
               
                <div class="panel panel-info">
                  <div class="panel-heading">
                    <h4 class="panel-title">
                      <a data-toggle="collapse" data-toggle="collapse" data-parent="#accordion" href="#文件上传">文件上传</a>
                      <span class="badge pull-right">1</span>
                    </h4>
                  </div>
                  <div id="文件上传" class="panel-collapse collapse">
                    
                      <a  href='/2015/03/01/files-upload.html' class="list-group-item pjaxlink">
                        php文件上传
                      </a>
                    
                  </div>
                </div>
               
                <div class="panel panel-info">
                  <div class="panel-heading">
                    <h4 class="panel-title">
                      <a data-toggle="collapse" data-toggle="collapse" data-parent="#accordion" href="#Git">Git</a>
                      <span class="badge pull-right">1</span>
                    </h4>
                  </div>
                  <div id="Git" class="panel-collapse collapse">
                    
                      <a  href='/2015/03/10/Git-Resources.html' class="list-group-item pjaxlink">
                        Git常用命令速查表
                      </a>
                    
                  </div>
                </div>
               
                <div class="panel panel-info">
                  <div class="panel-heading">
                    <h4 class="panel-title">
                      <a data-toggle="collapse" data-toggle="collapse" data-parent="#accordion" href="#Mysql">Mysql</a>
                      <span class="badge pull-right">2</span>
                    </h4>
                  </div>
                  <div id="Mysql" class="panel-collapse collapse">
                    
                      <a  href='/2015/06/02/mysql%20-%20optimize.html' class="list-group-item pjaxlink">
                        Mysql优化小技巧
                      </a>
                    
                      <a  href='/2015/05/02/mysql-index%20.html' class="list-group-item pjaxlink">
                        Mysql索引文件本身的数据结构
                      </a>
                    
                  </div>
                </div>
               
                <div class="panel panel-info">
                  <div class="panel-heading">
                    <h4 class="panel-title">
                      <a data-toggle="collapse" data-toggle="collapse" data-parent="#accordion" href="#Linux、PHP">Linux、PHP</a>
                      <span class="badge pull-right">2</span>
                    </h4>
                  </div>
                  <div id="Linux、PHP" class="panel-collapse collapse">
                    
                      <a  href='/2015/06/15/linux-nginx.html' class="list-group-item pjaxlink">
                        linux 环境下 php 扩展安装通用方法
                      </a>
                    
                      <a  href='/2015/05/20/linux-php.html' class="list-group-item pjaxlink">
                        linux 环境下 php 扩展安装通用方法
                      </a>
                    
                  </div>
                </div>
               
                <div class="panel panel-info">
                  <div class="panel-heading">
                    <h4 class="panel-title">
                      <a data-toggle="collapse" data-toggle="collapse" data-parent="#accordion" href="#Linux">Linux</a>
                      <span class="badge pull-right">6</span>
                    </h4>
                  </div>
                  <div id="Linux" class="panel-collapse collapse">
                    
                      <a  href='/2015/07/06/Linux4.html' class="list-group-item pjaxlink">
                        Linux 4：磁盘与文件系统管理
                      </a>
                    
                      <a  href='/2015/07/05/Linux3.html' class="list-group-item pjaxlink">
                        Linux 3：文件与目录管理
                      </a>
                    
                      <a  href='/2015/07/04/Linux2.html' class="list-group-item pjaxlink">
                        Linux 2：文件权限与目录配置
                      </a>
                    
                      <a  href='/2015/07/03/Linux.html' class="list-group-item pjaxlink">
                        Linux 1：登陆与在线求助man page
                      </a>
                    
                      <a  href='/2015/07/02/Linux-Problems.html' class="list-group-item pjaxlink">
                        Linux 0：实际问题
                      </a>
                    
                      <a  href='/2015/06/11/Lnmp.html' class="list-group-item pjaxlink">
                        Linux下 nginx安装 + php-fpm安装
                      </a>
                    
                  </div>
                </div>
               
                <div class="panel panel-info">
                  <div class="panel-heading">
                    <h4 class="panel-title">
                      <a data-toggle="collapse" data-toggle="collapse" data-parent="#accordion" href="#Lamp">Lamp</a>
                      <span class="badge pull-right">1</span>
                    </h4>
                  </div>
                  <div id="Lamp" class="panel-collapse collapse">
                    
                      <a  href='/2015/06/15/linux-lamp.html' class="list-group-item pjaxlink">
                        lamp环境的搭建
                      </a>
                    
                  </div>
                </div>
               
                <div class="panel panel-info">
                  <div class="panel-heading">
                    <h4 class="panel-title">
                      <a data-toggle="collapse" data-toggle="collapse" data-parent="#accordion" href="#linux/redis">linux/redis</a>
                      <span class="badge pull-right">1</span>
                    </h4>
                  </div>
                  <div id="linux/redis" class="panel-collapse collapse">
                    
                      <a  href='/2015/06/15/linux-redis.html' class="list-group-item pjaxlink">
                        Linux环境下redis的搭建
                      </a>
                    
                  </div>
                </div>
               
                <div class="panel panel-info">
                  <div class="panel-heading">
                    <h4 class="panel-title">
                      <a data-toggle="collapse" data-toggle="collapse" data-parent="#accordion" href="#高并发">高并发</a>
                      <span class="badge pull-right">1</span>
                    </h4>
                  </div>
                  <div id="高并发" class="panel-collapse collapse">
                    
                      <a  href='/2015/08/03/about-optimize.html' class="list-group-item pjaxlink">
                        高并发
                      </a>
                    
                  </div>
                </div>
               
                <div class="panel panel-info">
                  <div class="panel-heading">
                    <h4 class="panel-title">
                      <a data-toggle="collapse" data-toggle="collapse" data-parent="#accordion" href="#memcache">memcache</a>
                      <span class="badge pull-right">1</span>
                    </h4>
                  </div>
                  <div id="memcache" class="panel-collapse collapse">
                    
                      <a  href='/2015/09/06/Linux%20-%20memcache.html' class="list-group-item pjaxlink">
                        memcache实现高可用方案
                      </a>
                    
                  </div>
                </div>
              
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
      <div class="col-md-13 col-lg-13 col-sm-13 col-xs-13 aside3">
        <div id="container">
          <div id="pjax">
            <div class="row">
  <div class="col-md-13 aside3-title">
    <br>
    <h2 id="#identifier">Linux下 nginx安装 + php-fpm安装</h2>
    2015年06月11日
  </div>
  <div class="col-md-13 aside3-content">
    <hr>
    <div id="content">
      <h1>Linux下 nginx安装 + php-fpm安装</h1>

<ol>
<li><p>编译环境准备</p>

<blockquote>
<p>yum -y install gcc automake autoconf libtool make  gcc  gcc-c++</p>
</blockquote></li>
<li><p>一般都需要先装pcre、 zlib，前者为了重写rewrite，后者为了gzip压缩
源代码目录：/usr/local/src</p></li>
<li><p>安装pcre 和 zlib 和 ssl</p>

<blockquote>
<p>cd /usr/local/src
wget ftp://ftp.csx.cam.ac.uk/pub/software/programming/pcre/pcre-8.34.tar.gz 
tar -zxvf pcre-8.34.tar.gz
cd pcre-8.34
./configure
make
make install</p>

<p>cd /usr/local/src
wget http://zlib.net/zlib-1.2.8.tar.gz
tar -zxvf zlib-1.2.8.tar.gz
cd zlib-1.2.8
./configure
make
make install</p>

<p>cd /usr/local/src
wget http://www.openssl.org/source/openssl-1.0.1c.tar.gz
tar -zxvf openssl-1.0.1c.tar.gz</p>
</blockquote></li>
<li><p>nginx 安装</p>

<blockquote>
<p>cd /usr/local/src
wget http://nginx.org/download/nginx-1.4.2.tar.gz
tar -zxvf nginx-1.4.2.tar.gz
cd nginx-1.4.2</p>

<p>./configure --sbin-path=/usr/local/nginx/nginx  \
--conf-path=/usr/local/nginx/nginx.conf  \
--pid-path=/usr/local/nginx/nginx.pid</p>

<p>make
make install</p>
</blockquote></li>
<li><p>安装成功后，/usr/local/nginx 目录下如下
fastcgi.conf            koi-win             nginx.conf.default
fastcgi.conf.default    logs                scgi<em>params
fastcgi</em>params          mime.types          scgi<em>params.default
fastcgi</em>params.default  mime.types.default  uwsgi<em>params
html                    nginx               uwsgi</em>params.default
koi-utf                 nginx.conf          win-utf</p></li>
<li><p>启动之前先确保 80 端口没有被占用，执行 /usr/local/nginx/nginx 启动</p>

<blockquote>
<p>netstat -an | grep 80</p>

<p>lsof -i | grep 80</p>

<p>netstat -tunpl | grep 80</p>

<p>/usr/local/nginx/nginx</p>
</blockquote></li>
<li><p>fpm-php 安装(5.3.3之后默认自带 加上参数 --enable-fpm 开启)</p>

<blockquote>
<p>tar -zxvf php-5.3.28.tar.gz</p>

<p>cd php-5.3.28</p>

<p>./configure --prefix=/usr/local/php  --enable-fpm </p>
</blockquote></li>
<li><p>更改nginx的配置文件 nginx.conf ，增加，并增加php-fpm的配置文件</p>

<p>location ~ .php$ {
    root html;
    fastcgi<em>pass 127.0.0.1:9000;
    fastcgi</em>index index.php;
    fastcgi<em>param SCRIPT</em>FILENAME $document<em>root$fastcgi</em>script<em>name;
    include fastcgi</em>params;
}</p>

<blockquote>
<p>cd /usr/local/phpfpm/etc</p>

<p>cp php-fpm.conf.default php-fpm.conf</p>
</blockquote></li>
<li><p>将 fpm-php 加入系统服务 (/usr/local/src/php-5.3.28/ )，并启动</p>

<blockquote>
<p>cp ./sapi/fpm/init.d.php-fpm /etc/init.d/php-fpm</p>

<p>chmod +x /etc/init.d/php-fpm</p>

<p>chkconfig --add php-fpm</p>

<p>chkconfig php-fpm on</p>

<p>service php-fpm start</p>
</blockquote></li>
<li><p>使用 phpinfo() 函数测试即可</p></li>
</ol>

<p>附：
I. 在编译安装时候可能遇到的一些问题
    a. 编译pcre错误
    libtool: compile: unrecognized option <code>-DHAVE_CONFIG_H&#39;
    libtool: compile: Try</code>libtool --help&#39; for more information.
    make[1]: *** [pcrecpp.lo] Error 1
    make[1]: Leaving directory `/usr/local/src/pcre-8.34&#39;
    make: *** [all] Error 2</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">解决方案：

&gt; yum install -y g++

make 时候出错

解决方案：
&gt; yum -y install openssl openssl-devel
</code></pre></div>
<p>II. nginx编译选项</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">a. configure命令是用来检测你的安装平台的目标特征的。它定义了系统的各个方面，包括nginx的被允许使用的连接处理的方法，比如它会检测你是不是有CC或GCC，并不是需要CC或GCC，它是个shell脚本，执行结束时，它会创建一个Makefile文件

b. make是用来编译的，它从Makefile中读取指令，然后编译

c. make install是用来安装的，它也从Makefile中读取指令，安装到指定的位置

nginx的configure命令支持以下参数：

    --prefix=PATH  定义一个安装目录，也就是nginx的安装目录。默认使用 /usr/local/nginx

    --sbin-path=PATH 设置nginx的可执行文件的路径，默认为  prefix/sbin/nginx

    --conf-path=PATH  设置在nginx.conf配置文件的路径。nginx允许使用不同的配置文件启动，通过命令行中的-c选项。默认为prefix/conf/nginx.conf

    --pid-path=PATH  设置nginx.pid文件，将存储的主进程的进程号。安装完成后，可以随时改变的文件名 ， 在nginx.conf配置文件中使用 PID指令。默认情况下，文件名 为prefix/logs/nginx.pid

    --error-log-path=PATH 设置主错误，警告，和诊断文件的名称。安装完成后，可以随时改变的文件名 ，在nginx.conf配置文件中 使用 的error_log指令。默认情况下，文件名 为prefix/logs/error.log

    --http-log-path=PATH 设置主请求的HTTP服务器的日志文件的名称。安装完成后，可以随时改变的文件名 ，在nginx.conf配置文件中 使用 的access_log指令。默认情况下，文件名 为prefix/logs/access.log

    --user=name 设置nginx工作进程的用户，默认的用户名是nobody

    --group=name  设置nginx工作进程的用户组。安装完成后，可以随时更改的名称在nginx.conf配置文件中 使用的 user指令。默认的为非特权用户。

    --with-select_module --without-select_module 启用或禁用构建一个模块来允许服务器使用select()方法。该模块将自动建立，如果平台不支持的kqueue，epoll，rtsig或/dev/poll

    --with-poll_module --without-poll_module 启用或禁用构建一个模块来允许服务器使用poll()方法。该模块将自动建立，如果平台不支持的kqueue，epoll，rtsig或/dev/poll

    --without-http_gzip_module 不编译压缩的HTTP服务器的响应模块。编译并运行此模块需要zlib库

    --without-http_rewrite_module 不编译重写模块。编译并运行此模块需要PCRE库支持

    --without-http_proxy_module 不编译http_proxy模块

    --with-http_ssl_module  使用https协议模块。默认情况下，该模块没有被构建。建立并运行此模块的OpenSSL库是必需的

    --with-pcre=PATH 设置PCRE库的源码路径。PCRE库的源码（版本4.4 - 8.30）需要从PCRE网站下载并解压。其余的工作是Nginx的./ configure和make来完成。正则表达式使用在location指令和 ngx_http_rewrite_module 模块中

    --with-pcre-jit 编译PCRE包含just-in-time compilation”（1.1.12中， pcre_jit指令）

    --with-zlib=PATH 设置的zlib库的源码路径。要下载从 zlib（版本1.1.3 - 1.2.5）的并解压。其余的工作是Nginx的./ configure和make完成。ngx_http_gzip_module模块需要使用zlib 

    --with-cc-opt=parameters
     设置额外的参数将被添加到CFLAGS变量。例如,当你在FreeBSD上使用PCRE库时需要使用:--with-cc-opt=&quot;-I /usr/local/include。.如需要需要增加 select()支持的文件数量:--with-cc-opt=&quot;-D FD_SETSIZE=2048&quot;

    --with-ld-opt=parameters 设置附加的参数，将用于在链接期间。例如，当在FreeBSD下使用该系统的PCRE库,应指定:--with-ld-opt=&quot;-L /usr/local/lib&quot;
</code></pre></div>
<p>Status API Training Shop Blog About Pricing
© 2015 GitHub, Inc. Terms Privacy Security Contact Help</p>

    </div>
    <hr>
    <div id="disqus_thread">
  <button type="button" name="myyphp" class="btn btn-default show-commend">	
  	<i class="fa fa-comment-o fa-lg" style="color: #16a095;"></i>     <!-- 修改显示评论按钮图标-->
  </button>
</div>

  </div>
  <!-- 目录 -->
  <div id="content_table" style="position:fixed;right:20px;top:120px;display:none;">
    <div class="panel panel-success">
      <div class="panel-body" id="nav"></div>
    </div>
  </div>
</div>


          </div>
        </div>
      </div>
    </div>
  </div>
  <div style="position:fixed;right:15px;top:62px;">
  <button id="content_btn" class="btn btn-primary" style="width:43px; height:34px;">
    <i class="fa fa-lg fa-plus"></i>
  </button>
</div>
<div style="position:fixed;right:15px;top:20px;">
  <button id="nav_btn" class="btn btn-primary">
    <i class="fa fa-lg fa-navicon"></i>
  </button>
</div>
<script type="text/javascript" src="/public/js/jquery.js"></script>
<script type="text/javascript" src="/public/js/bootstrap.js"></script>
<script src="/public/js/jquery.pjax.js"></script>
<script src="/public/js/prettify/prettify.js"></script>
<script src="/public/js/base.js"></script>
<!--
<script src="/public/js/jquery.scrollUp.js"></script>
-->
<script>
    $('a[href="#读书"]').tab('show');
</script>


<!--button是右上方导航和显示目录的按钮-->


  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-54262064-1', 'painterlin.com');
  ga('send', 'pageview');
</script>
</body>
</html>